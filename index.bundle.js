(()=>{"use strict";var t,i={947:(t,i,e)=>{e.d(i,{Z:()=>r});var n=e(537),a=e.n(n),o=e(645),s=e.n(o)()(a());s.push([t.id,".game-canvas {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n}","",{version:3,sources:["webpack://./src/App.module.css"],names:[],mappings:"AAAA;EACE,WAAW;EACX,YAAY;EACZ,kBAAkB;EAClB,MAAM;EACN,OAAO;AACT",sourcesContent:[".game-canvas {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n}"],sourceRoot:""}]),s.locals={"game-canvas":"game-canvas"};const r=s},488:(t,i,e)=>{e.d(i,{Z:()=>r});var n=e(537),a=e.n(n),o=e(645),s=e.n(o)()(a());s.push([t.id,".ui-controller {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  z-index: 999;\n}\n\n.ui-air-container {\n  display: flex;\n  flex-direction: row;\n  margin-left: 10vw;\n  color: white;\n  font-size: 25px;\n  font-family: pixel-font, sans-serif;\n  align-items: center;\n  gap: 10px;\n  width: 80vw;\n}\n\n.ui-hp-container {\n  display: flex;\n  flex-direction: row;\n  margin-top: 10vh;\n  margin-left: 10vw;\n  color: white;\n  font-size: 25px;\n  font-family: pixel-font, sans-serif;\n  align-items: center;\n  gap: 10px;\n  width: 80vw;\n}\n\n@keyframes air-leak {\n  0% {\n    width: 100%;\n  }\n  100% {\n    width: 0%;\n  }\n}\n\n.ui-air-bar {\n  border-radius: 10px;\n  background: rgba(0, 208, 255, 0.867);\n  height: 20px;\n  animation: air-leak;\n  animation-timing-function: linear;\n}\n\n\n.ui-hp-bar {\n  border-radius: 10px;\n  background: #ba1e1e;\n  height: 20px;\n  width: 100%;\n}\n","",{version:3,sources:["webpack://./src/react-ui/UIController.module.css"],names:[],mappings:"AAAA;EACE,kBAAkB;EAClB,WAAW;EACX,YAAY;EACZ,MAAM;EACN,OAAO;EACP,YAAY;AACd;;AAEA;EACE,aAAa;EACb,mBAAmB;EACnB,iBAAiB;EACjB,YAAY;EACZ,eAAe;EACf,mCAAmC;EACnC,mBAAmB;EACnB,SAAS;EACT,WAAW;AACb;;AAEA;EACE,aAAa;EACb,mBAAmB;EACnB,gBAAgB;EAChB,iBAAiB;EACjB,YAAY;EACZ,eAAe;EACf,mCAAmC;EACnC,mBAAmB;EACnB,SAAS;EACT,WAAW;AACb;;AAEA;EACE;IACE,WAAW;EACb;EACA;IACE,SAAS;EACX;AACF;;AAEA;EACE,mBAAmB;EACnB,oCAAoC;EACpC,YAAY;EACZ,mBAAmB;EACnB,iCAAiC;AACnC;;;AAGA;EACE,mBAAmB;EACnB,mBAAmB;EACnB,YAAY;EACZ,WAAW;AACb",sourcesContent:[".ui-controller {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  z-index: 999;\n}\n\n.ui-air-container {\n  display: flex;\n  flex-direction: row;\n  margin-left: 10vw;\n  color: white;\n  font-size: 25px;\n  font-family: pixel-font, sans-serif;\n  align-items: center;\n  gap: 10px;\n  width: 80vw;\n}\n\n.ui-hp-container {\n  display: flex;\n  flex-direction: row;\n  margin-top: 10vh;\n  margin-left: 10vw;\n  color: white;\n  font-size: 25px;\n  font-family: pixel-font, sans-serif;\n  align-items: center;\n  gap: 10px;\n  width: 80vw;\n}\n\n@keyframes air-leak {\n  0% {\n    width: 100%;\n  }\n  100% {\n    width: 0%;\n  }\n}\n\n.ui-air-bar {\n  border-radius: 10px;\n  background: rgba(0, 208, 255, 0.867);\n  height: 20px;\n  animation: air-leak;\n  animation-timing-function: linear;\n}\n\n\n.ui-hp-bar {\n  border-radius: 10px;\n  background: #ba1e1e;\n  height: 20px;\n  width: 100%;\n}\n"],sourceRoot:""}]),s.locals={"ui-controller":"ui-controller","ui-air-container":"ui-air-container","ui-hp-container":"ui-hp-container","ui-air-bar":"ui-air-bar","air-leak":"air-leak","ui-hp-bar":"ui-hp-bar"};const r=s},460:(t,i,e)=>{e.d(i,{Z:()=>r});var n=e(537),a=e.n(n),o=e(645),s=e.n(o)()(a());s.push([t.id,".dialog {\n  position: absolute;\n  top: 45%;\n  left: 50%;\n  transform: translateX(-50%);\n  z-index: 5;\n  background-color: rgba(0, 0, 0, 0.5);\n  align-items: center;\n  color: white;\n  display: flex;\n  flex-direction: row;\n}\n\n@keyframes text {\n  from {\n    width: 0%;\n  }\n  to {\n    width: 100%;\n  }\n}\n\n@keyframes fadeIn {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n\n.dialog-key {\n  width: 50px;\n  height: 50px;\n  text-align: center;\n  font-weight: bold;\n  font-size: 40px;\n  border: 3px gold solid;\n}\n\n.dialog-content {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  padding: 10px;\n  font-size: 25px;\n  font-family: pixel-font, sans-serif;\n}\n\n.dialog-animation-text {\n  animation-name: text;\n  animation-duration: 1s;\n  animation-timing-function: linear;\n}\n\n.dialog-animation-fade {\n  animation-name: fadeIn;\n  animation-duration: 200ms;\n  animation-timing-function: linear;\n}\n","",{version:3,sources:["webpack://./src/react-ui/components/Dialog.module.css"],names:[],mappings:"AAAA;EACE,kBAAkB;EAClB,QAAQ;EACR,SAAS;EACT,2BAA2B;EAC3B,UAAU;EACV,oCAAoC;EACpC,mBAAmB;EACnB,YAAY;EACZ,aAAa;EACb,mBAAmB;AACrB;;AAEA;EACE;IACE,SAAS;EACX;EACA;IACE,WAAW;EACb;AACF;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA;EACE,WAAW;EACX,YAAY;EACZ,kBAAkB;EAClB,iBAAiB;EACjB,eAAe;EACf,sBAAsB;AACxB;;AAEA;EACE,gBAAgB;EAChB,uBAAuB;EACvB,mBAAmB;EACnB,aAAa;EACb,eAAe;EACf,mCAAmC;AACrC;;AAEA;EACE,oBAAoB;EACpB,sBAAsB;EACtB,iCAAiC;AACnC;;AAEA;EACE,sBAAsB;EACtB,yBAAyB;EACzB,iCAAiC;AACnC",sourcesContent:[".dialog {\n  position: absolute;\n  top: 45%;\n  left: 50%;\n  transform: translateX(-50%);\n  z-index: 5;\n  background-color: rgba(0, 0, 0, 0.5);\n  align-items: center;\n  color: white;\n  display: flex;\n  flex-direction: row;\n}\n\n@keyframes text {\n  from {\n    width: 0%;\n  }\n  to {\n    width: 100%;\n  }\n}\n\n@keyframes fadeIn {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n\n.dialog-key {\n  width: 50px;\n  height: 50px;\n  text-align: center;\n  font-weight: bold;\n  font-size: 40px;\n  border: 3px gold solid;\n}\n\n.dialog-content {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  padding: 10px;\n  font-size: 25px;\n  font-family: pixel-font, sans-serif;\n}\n\n.dialog-animation-text {\n  animation-name: text;\n  animation-duration: 1s;\n  animation-timing-function: linear;\n}\n\n.dialog-animation-fade {\n  animation-name: fadeIn;\n  animation-duration: 200ms;\n  animation-timing-function: linear;\n}\n"],sourceRoot:""}]),s.locals={dialog:"dialog","dialog-key":"dialog-key","dialog-content":"dialog-content","dialog-animation-text":"dialog-animation-text",text:"text","dialog-animation-fade":"dialog-animation-fade",fadeIn:"fadeIn"};const r=s},113:(t,i,e)=>{var n=e(784),a=e(29),o=e(379),s=e.n(o),r=e(795),h=e.n(r),l=e(569),c=e.n(l),d=e(565),u=e.n(d),m=e(216),p=e.n(m),A=e(589),f=e.n(A),g=e(947),y={};y.styleTagTransform=f(),y.setAttributes=u(),y.insert=c().bind(null,"head"),y.domAPI=h(),y.insertStyleElement=p(),s()(g.Z,y),g.Z&&g.Z.locals&&g.Z.locals;var w=e(940),v=e(277);function x({frameSize:t,animationNames:i,assetPath:e,idleAnimationName:n,animationSettings:a,scale:o="1"}){return s=this,r=void 0,l=function*(){const s=i.map(((i,e)=>function(t,i,e){const n={};for(let a=0;a<4;a++)n[`${t}${a}`]={frame:{x:a*e.width,y:i*e.height,w:e.width,h:e.height},sourceSize:{w:e.width,h:e.height}};return n}(i,e,t))),r={frames:Object.assign({},...s),meta:{scale:o},animations:s.reduce(((t,e,n)=>(t[i[n]]=Object.keys(e),t)),{})},h=new w.c2G(w.VL4.from(e),r);yield h.parse();const l=new w.W20;return l.switchAnimation=t=>{l.children.length>0&&l.removeChildAt(0);const i=new w.KgH(h.animations[t]);l.addChild(i),a&&(Object.assign(i,a["*"],a[t]),(null==i?void 0:i.autoPlay)&&i.play())},l.spriteSheet=h,l.play=()=>{var t;return null===(t=l.children[0])||void 0===t?void 0:t.play()},l.nextFrame=()=>{const t=l.children[0];t.currentFrame=t.currentFrame+1>=t.totalFrames?0:t.currentFrame+1},l.prevFrame=()=>{const t=l.children[0];t.currentFrame=t.currentFrame-1<0?t.totalFrames:t.currentFrame-1},l.switchAnimation(n),l},new((h=void 0)||(h=Promise))((function(t,i){function e(t){try{a(l.next(t))}catch(t){i(t)}}function n(t){try{a(l.throw(t))}catch(t){i(t)}}function a(i){var a;i.done?t(i.value):(a=i.value,a instanceof h?a:new h((function(t){t(a)}))).then(e,n)}a((l=l.apply(s,r||[])).next())}));var s,r,h,l}const k=100,C=12e4;var E;!function(t){t[t.floor=0]="floor",t[t.wall=1]="wall",t[t.door=2]="door"}(E||(E={}));const b=new class{constructor(){this.eventCounter=0}listen(t){this.listener=t}showDialog(t,i){var e;const n=(this.eventCounter++).toString();null===(e=this.listener)||void 0===e||e.call(this,"dialog-new",{id:n,type:"dialog",content:t,options:i});const a=()=>this.closeDialog(n);return(null==i?void 0:i.dismissTimeout)&&setTimeout(a,i.dismissTimeout),a}takeDamage(){var t;null===(t=this.listener)||void 0===t||t.call(this,"takeDamage",void 0)}showUI(){var t;null===(t=this.listener)||void 0===t||t.call(this,"show-bars-ui",void 0)}hideUI(){var t;null===(t=this.listener)||void 0===t||t.call(this,"hide-bars-ui",void 0)}closeDialog(t){var i;null===(i=this.listener)||void 0===i||i.call(this,"dialog-delete",{id:t})}};function B(t,i){return Math.floor(Math.random()*(i-t+1))+t}const M=["Putain !","Merde !","Helleveta !","Bordel !"];class T extends w.W20{constructor(t,i){super(),this.map=t,this.app=i,this.kind="character",this.lastDamageTime=0,this.isDestroyed=!1,this.zIndex=1,this.speed=5}init(){return t=this,i=void 0,n=function*(){this.animation=yield x({frameSize:{width:100,height:120},assetPath:"assets/character-sprite.png",animationNames:["walk-down","walk-up","walk-left","walk-right","idle"],idleAnimationName:"idle",animationSettings:{"*":{animationSpeed:.1666,loop:!0,autoPlay:!0},idle:{autoPlay:!0,animationSpeed:.0666}},scale:"1.4"}),this.addChild(this.animation),this.animation.x=(k-this.width)/2,this.stopWalking(),this.app.ticker.add(this.onTick.bind(this))},new((e=void 0)||(e=Promise))((function(a,o){function s(t){try{h(n.next(t))}catch(t){o(t)}}function r(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?a(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(s,r)}h((n=n.apply(t,i||[])).next())}));var t,i,e,n}destroy(){super.destroy(),this.isDestroyed=!0,this.app.ticker.remove(this.onTick.bind(this))}hasHadRecentDamages(){return Date.now()-this.lastDamageTime<1e3}takeDamages(){this.hasHadRecentDamages()||(this.lastDamageTime=Date.now(),b.takeDamage(),b.showDialog({message:M[B(0,M.length-1)]},{dismissTimeout:1e3}))}onTick(t){if(!this.isDestroyed&&(this.hasHadRecentDamages()?this.alpha=.5:this.alpha=1,this.walkDirection))switch(this.walkDirection){case"up":this.move(0,this.speed*t);break;case"down":this.move(0,-this.speed*t);break;case"left":this.move(this.speed*t,0);break;case"right":this.move(-this.speed*t,0)}}move(t,i){const e={x:this.x+-1*t,y:this.y+-1*i};this.collidesWithWall(e,t,i)?this.stopWalking():(this.x=e.x,this.y=e.y,this.zIndex=Math.round(e.y/k),this.map.container.y+=i,this.map.container.x+=t)}collidesWithWall(t,i,e){const n=Math.floor(this.x/k)!==Math.floor((this.x+this.width)/k),a=Math.floor(this.y/k)!==Math.floor((this.y+this.height)/k),o=[];return e<0||e>0?(o.push({x:Math.floor((t.x+20)/k),y:Math.ceil((t.y-this.height/2)/k)}),n&&o.push({x:Math.floor((t.x+this.width)/k),y:Math.ceil((t.y-this.height/2)/k)})):i>0?(o.push({x:Math.floor((t.x+20)/k),y:Math.ceil((t.y-this.height/2)/k)}),a&&o.push({x:Math.floor((t.x+20)/k),y:Math.ceil((t.y-this.height/2)/k)})):i<0&&(o.push({x:Math.floor((t.x+this.width)/k),y:Math.ceil((t.y-this.height/2)/k)}),a&&o.push({x:Math.floor((t.x+this.width)/k),y:Math.ceil((t.y-this.height/2)/k)})),o.some((i=>{const e=this.map.cells.find((t=>t.x===i.x&&t.y===i.y&&t.solid));return!!e&&(e.kind===E.wall&&(e.properties.wallType.includes("vertical")||e.properties.wallType.includes("right-corner"))&&"vertical-T"!==e.properties.wallType?t.x<e.x*k+10:e.solid)}))}walk(t){this.walkDirection!==t&&(this.stopWalking(),this.walkDirection=t,this.animation.switchAnimation(`walk-${t}`))}stopWalking(){this.walkDirection=void 0,this.animation.switchAnimation("idle")}}var D;function S(t,i,e){const n={top:void 0,bottom:void 0,left:void 0,right:void 0,self:void 0};return e.forEach((e=>{e.kind!==E.wall&&e.kind!==E.door||(e.x===t&&e.y===i&&(n.self=e),e.x===t-1&&e.y===i&&(n.left=e),e.x===t+1&&e.y===i&&(n.right=e),e.x===t&&e.y===i-1&&(n.top=e),e.x===t&&e.y===i+1&&(n.bottom=e))})),n}function I({x:t,y:i},e){var n,a,o,s,r;const h=S(t,i,e),l=null===(a=null===(n=h.top)||void 0===n?void 0:n.properties)||void 0===a?void 0:a.wallType,c=null===(s=null===(o=h.self)||void 0===o?void 0:o.properties)||void 0===s?void 0:s.wallType;return(null===(r=h.self)||void 0===r?void 0:r.kind)===E.door||(null==c?void 0:c.includes("window"))?"floor":h.self?!(null==l?void 0:l.includes("horizontal"))&&"vertical-T"!==l||"horizontal-right-corner-bottom"===l?"floor-shadow-left":"floor-shadow-corner":h.top&&((null==l?void 0:l.includes("horizontal"))||h.top.kind===E.door)?"horizontal-right-corner-top"===l?"floor-shadow-top-left":"floor-shadow-top":"floor"}function z({x:t,y:i},e){var n;const a=S(t,i,e);if(a.left&&a.right){if(a.bottom)return"horizontal-T";if("horizontal-window-left"===(null===(n=a.left.properties)||void 0===n?void 0:n.wallType))return"horizontal-window-right";const t=!!e.find((t=>a.right.x+1===t.x&&a.right.y===t.y&&t.kind===E.wall));return a.right.kind===E.wall&&t&&0===B(0,3)?"horizontal-window-left":"horizontal"}return a.top&&a.bottom?a.right?"vertical-T":"vertical":a.left?a.bottom?"horizontal-right-corner-bottom":a.top?"horizontal-right-corner-top":"horizontal-right":a.right?a.bottom?"horizontal-left-corner-bottom":a.top?"horizontal-left-corner-top":"horizontal-left":a.top?"vertical-bottom":a.bottom?"vertical-top":"pillar"}!function(t){t[t.North=0]="North",t[t.East=1]="East",t[t.South=2]="South",t[t.West=3]="West"}(D||(D={}));function W(t,i){switch(i){case D.North:return t.reduce(((t,i)=>i.y<t.y?i:t));case D.East:return t.reduce(((t,i)=>i.x>t.x?i:t));case D.South:return t.reduce(((t,i)=>i.y>t.y?i:t));case D.West:return t.reduce(((t,i)=>i.x<t.x?i:t))}}function P(t,i){return B(Math.max(t.x+1,i.x+1),Math.min(t.x+t.width-2,i.x+i.width-2))}function N(t,i){return B(Math.max(t.y+1,i.y+1),Math.min(t.y+t.height-2,i.y+i.height-2))}class F{constructor(){this.container=new w.W20,this.entities=[];const{map:t,startCoords:i,rooms:e}=function(){const t=Array.from({length:10}).map((()=>({x:0,y:0,width:B(5,10),height:B(5,10)})));t.slice(1).forEach(((i,e)=>{const n=B(0,3);!function(t,i,e){const n=B(1,2),a=Math.min(t.width,e.width),o=Math.min(t.height,e.height);let s,r;const h=1===B(0,1)?1:-1;switch(i){case D.North:t.y=e.y-t.height-n,t.x=e.x+B(0,a-3)*h,s=P(t,e),t.corridor={from:{x:s,y:t.y+t.height-1},to:{x:s,y:e.y},direction:i};break;case D.East:t.x=e.x+e.width+n,t.y=e.y+B(0,o-3)*h,r=N(t,e),t.corridor={from:{x:t.x,y:r},to:{x:e.x+e.width-1,y:r},direction:i};break;case D.South:t.y=e.y+e.height+n,t.x=e.x+B(0,a-3)*h,s=P(t,e),t.corridor={from:{x:s,y:t.y},to:{x:s,y:e.y+e.height-1},direction:i};break;case D.West:t.x=e.x-t.width-n,t.y=e.y+B(0,o-3)*h,r=N(t,e),t.corridor={from:{x:t.x+t.width-1,y:r},to:{x:e.x,y:r},direction:i}}}(i,n,0===e?t[0]:W(t,n))}));const i=W(t,D.West),e=W(t,D.North),n=i.x,a=e.y,o=[];return t.forEach((t=>{for(let i=0;i<t.height;i++)for(let e=0;e<t.width;e++){const s=0===e||e===t.width-1||0===i||i===t.height-1,r=Math.abs(n-(t.x+e)),h=Math.abs(a-(t.y+i));void 0===o[h]&&(o[h]=[]),o[h][r]=s?E.wall:E.floor}t.actualCenter={x:Math.abs(n-(t.x+Math.floor(t.width/2))),y:Math.abs(a-(t.y+Math.floor(t.height/2)))}})),t.filter((t=>!!t.corridor)).forEach((t=>{const{from:i,to:e,direction:s}=t.corridor,r=s===D.North||s===D.South?Math.abs(i.y-e.y):Math.abs(i.x-e.x);for(let t=0;t<=r;t++){let e=Math.abs(n-i.x),r=Math.abs(a-i.y);s===D.North?r+=t:s===D.East?e-=t:s===D.South?r-=t:s===D.West&&(e+=t),void 0===o[r]&&(o[r]=[]),o[r][e]=0,s===D.North||s===D.South?(o[r][e-1]=1,o[r][e+1]=1):s!==D.East&&s!==D.West||(void 0===o[r-1]&&(o[r-1]=[]),void 0===o[r+1]&&(o[r+1]=[]),o[r-1][e]=1,o[r+1][e]=1)}if(s===D.North||s===D.South){const t=Math.abs(n-e.x),i=Math.abs(a-e.y);o[i][t]=2}})),{rooms:t,map:o,startCoords:{x:Math.abs(n-(t[0].x+Math.floor(t[0].width/2))),y:Math.abs(a-(t[0].y+Math.floor(t[0].height/2)))}}}();this.rooms=e,this.rawMap=t,this.startLocation=i}init(){return t=this,i=void 0,n=function*(){this.cells=yield function(t){return i=this,e=void 0,a=function*(){const i=t.reduce(((i,e,n)=>(e.forEach(((e,a)=>{var o;const s=e;i.push({kind:s,x:a,y:n,solid:s===E.wall||s===E.door,damage:0}),s!==E.wall&&s!==E.door||void 0===t[n][a+1]||void 0===(null===(o=t[n-1])||void 0===o?void 0:o[a])||i.push({kind:E.floor,x:a,y:n,solid:!1,damage:0})})),i)),[]);for(let t=0;t<i.length;t++){const n=i[t],a=i.find((t=>t.x===n.x-1&&t.y===n.y&&t.kind===E.wall));switch(n.kind){case E.wall:if(n.properties={wallType:z(n,i)},n.properties.windowType="horizontal-window-left"===(e=n.properties).wallType?"left":"horizontal-window-right"===e.wallType?"right":void 0,"right"===n.properties.windowType?n.damage=a.damage:n.properties.windowType&&(n.damage=B(0,3)),n.properties.wallType.includes("window")){n.asset=yield x({frameSize:{width:100,height:200},assetPath:`assets/walls/${n.properties.wallType}.png`,animationNames:["default"],idleAnimationName:"default",animationSettings:{"*":{animationSpeed:.1666,loop:!1}}});for(let t=n.damage;t>0;t--)n.asset.nextFrame();n.asset.pivot.y=n.asset.height/2}else n.asset=w.jyi.from(`assets/walls/${n.properties.wallType}.png`),n.asset.anchor.y=n.asset.height/2;n.asset.zIndex=n.y;break;case E.floor:n.properties={floorType:I(n,i)},n.asset=w.jyi.from(`assets/floors/${n.properties.floorType}.png`),n.asset.zIndex=-1;break;case E.door:n.asset=yield x({frameSize:{width:100,height:200},assetPath:"assets/door.png",animationNames:["open","close"],idleAnimationName:"open",animationSettings:{"*":{animationSpeed:.1666,loop:!1}}}),n.properties={open:!1,toggle:()=>{const t=n;t.properties.open?t.properties.open&&(t.properties.open=!1,t.solid=!0,t.asset.switchAnimation("close"),t.asset.play()):(t.properties.open=!0,t.solid=!1,t.asset.switchAnimation("open"),t.asset.play())}},n.asset.zIndex=n.y,n.asset.pivot.y=n.asset.height/2}n.asset.x=n.x*k,n.asset.y=n.y*k}var e;return i},new((n=void 0)||(n=Promise))((function(t,o){function s(t){try{h(a.next(t))}catch(t){o(t)}}function r(t){try{h(a.throw(t))}catch(t){o(t)}}function h(i){var e;i.done?t(i.value):(e=i.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}h((a=a.apply(i,e||[])).next())}));var i,e,n,a}(this.rawMap),this.cells.forEach((t=>this.container.addChild(t.asset))),this.container.sortableChildren=!0},new((e=void 0)||(e=Promise))((function(a,o){function s(t){try{h(n.next(t))}catch(t){o(t)}}function r(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?a(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(s,r)}h((n=n.apply(t,i||[])).next())}));var t,i,e,n}destroy(){this.entities.forEach((t=>t.destroy())),this.container.destroy(),this.entities=[],this.cells=[]}addEntity(t){this.entities.push(t),this.container.addChild(t)}getEntities(){return this.entities}getCell(t,i){const e=Math.round(t/k),n=Math.round(i/k);return this.cells.find((t=>t.x===e&&t.y===n))}getCells(t,i,e){return this.cells.filter((n=>n.x>=Math.round((t-e)/k)&&n.x<=Math.round((t+e)/k)&&n.y>=Math.round((i-e)/k)&&n.y<=Math.round((i+e)/k)))}}class O{constructor(t,i,e){this.character=t,this.map=i,this.app=e,this.pressedKeys=new Set,this.isDestroyed=!1,this.checkForInteractions=()=>{var t,i,e,n,a,o;const{x:s,y:r}=this.character,h=this.map.getCells(s,r,40),l=h.some((t=>t.kind===E.door)),c=h.some((t=>t.kind===E.wall&&t.damage>0));if(l){if("interact"===(null===(t=this.currentDialog)||void 0===t?void 0:t.key))return;null===(i=this.currentDialog)||void 0===i||i.dismiss(),this.currentDialog={dismiss:b.showDialog({key:"E",message:"Interact"},{animation:"fade"}),key:"interact"}}else if(c){if("repair"===(null===(e=this.currentDialog)||void 0===e?void 0:e.key))return;null===(n=this.currentDialog)||void 0===n||n.dismiss(),this.currentDialog={dismiss:b.showDialog({key:"E",message:"Repair"},{animation:"fade"}),key:"repair"}}else{if("start"===(null===(a=this.currentDialog)||void 0===a?void 0:a.key))return;null===(o=this.currentDialog)||void 0===o||o.dismiss(),this.currentDialog=void 0}},window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this)),this.app.ticker.add(this.onTick.bind(this)),this.currentDialog={dismiss:b.showDialog({message:"Oh no ! The air is leaking out."},{dismissTimeout:3e3,animation:"text"}),key:"start"},b.showUI()}destroy(){var t;this.isDestroyed=!0,null===(t=this.currentDialog)||void 0===t||t.dismiss(),this.app.ticker.remove(this.onTick.bind(this)),window.removeEventListener("keydown",this.onKeyDown.bind(this)),window.removeEventListener("keyup",this.onKeyUp.bind(this))}onTick(){this.isDestroyed||this.checkForInteractions()}checkKeysPressed(){switch(this.pressedKeys.values().next().value){case"e":this.interact();break;case"ArrowUp":this.character.walk("up");break;case"ArrowDown":this.character.walk("down");break;case"ArrowLeft":this.character.walk("left");break;case"ArrowRight":this.character.walk("right");break;default:this.character.stopWalking()}}interact(){const{x:t,y:i}=this.character,e=this.map.getCells(t,i,40),n=e.find((t=>t.kind===E.door)),a=e.find((t=>t.kind===E.wall&&t.damage>0));!n||n.x===Math.round(t/k)&&n.y===Math.round((i+20)/k)&&Math.abs(n.y*k-i)<50?a&&(a.asset.prevFrame(),a.damage--):n.properties.toggle()}onKeyDown(t){(t.key.includes("Arrow")||"e"===t.key)&&(this.pressedKeys.add(t.key),this.checkKeysPressed())}onKeyUp(t){this.pressedKeys.delete(t.key),this.checkKeysPressed()}}function Z(t,i,e,n){return Math.sqrt(Math.pow(e-t,2)+Math.pow(n-i,2))}function R(t,i,e,n){const a=e.getCell(i.x-1,i.y-1),o=[];e.cells.forEach((t=>{o[t.y]||(o[t.y]=[]),void 0===o[t.y][t.x]&&(o[t.y][t.x]=t.solid?-1:0)})),o[t.y][t.x]=2;const s=function t(i,e){const o=i.pop();if(!o||e[o.y][o.x]>n)return!1;const{x:s,y:r}=o,h=e[r][s];if(a.x===s&&a.y===r)return!0;const l=h+1;return l>n||(r-1>=0&&0===e[r-1][s]&&(e[r-1][s]=l,i.push({y:r-1,x:s})),r+1<e.length&&0===e[r+1][s]&&(e[r+1][s]=l,i.push({y:r+1,x:s})),s-1>=0&&0===e[r][s-1]&&(e[r][s-1]=l,i.push({y:r,x:s-1})),s+1<e[r].length&&0===e[r][s+1]&&(e[r][s+1]=l,i.push({y:r,x:s+1}))),t(i,e)}([t],o);if(!s)return[];const r=[];let h=a.x,l=a.y;for(;;)if(r.unshift({x:h,y:l}),h-1>=0&&o[l][h-1]===o[l][h]-1)h--;else if(h+1<o[l].length&&o[l][h+1]===o[l][h]-1)h++;else if(l-1>=0&&o[l-1][h]===o[l][h]-1)l--;else{if(!(l+1<o.length&&o[l+1][h]===o[l][h]-1))break;l++}return r}class Y extends w.W20{constructor(t,i,e,n=200,a=55){super(),this.map=t,this.app=i,this.speed=e,this.detectionRange=n,this.hitRange=a,this.kind="enemy",this.app.ticker.add(this.onTick.bind(this))}init(){return t=this,i=void 0,n=function*(){this.animation=yield x({frameSize:{width:100,height:100},assetPath:"assets/enemy-sprite.png",animationNames:["walk-down","walk-up","walk-left","walk-right","idle"],idleAnimationName:"idle",animationSettings:{"*":{animationSpeed:.1666,loop:!0,autoPlay:!0},idle:{autoPlay:!0,animationSpeed:.0666}},scale:"1"}),this.addChild(this.animation),this.animation.x=(k-this.width)/2,this.stopWalking()},new((e=void 0)||(e=Promise))((function(a,o){function s(t){try{h(n.next(t))}catch(t){o(t)}}function r(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?a(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(s,r)}h((n=n.apply(t,i||[])).next())}));var t,i,e,n}takeDamages(){}destroy(){super.destroy(),this.app.ticker.remove(this.onTick.bind(this))}onTick(){var t;(null===(t=this.path)||void 0===t?void 0:t.length)>0&&this.walkOnPath();for(const t of this.map.getEntities()){const i=Z(this.x,this.y,t.x,t.y);if("character"===t.kind&&i<this.hitRange)t.takeDamages();else if("character"===t.kind&&i<this.detectionRange&&i>this.hitRange&&(!this.path||0===this.path.length||this.path[this.path.length-1].x!==Math.round(t.x/k)&&this.path[this.path.length-1].y!==Math.round(t.y/k))){const e=this.map.getCell(this.x-1,this.y-1);return void(this.path=R(e,t,this.map,i/k+4))}}}walkOnPath(){const t=this.path[0],i=t.x*k,e=t.y*k,n=i-this.x,a=e-this.y,o=Z(this.x,this.y,i,e);Math.abs(n)>Math.abs(a)?n>0?this.walk("right"):this.walk("left"):a>0?this.walk("down"):this.walk("up"),o<this.hitRange?(this.x=i,this.y=e,this.path.shift(),this.stopWalking()):(this.x+=n/o*this.speed,this.y+=a/o*this.speed)}walk(t){this.walkDirection!==t&&(this.stopWalking(),this.walkDirection=t,this.animation.switchAnimation(`walk-${t}`))}stopWalking(){this.walkDirection=void 0,this.animation.switchAnimation("idle")}}function j(t){return new Promise((i=>setTimeout(i,t)))}var U=function(t,i,e,n){return new(e||(e=Promise))((function(a,o){function s(t){try{h(n.next(t))}catch(t){o(t)}}function r(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?a(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(s,r)}h((n=n.apply(t,i||[])).next())}))};const K=new w.MxU({width:window.innerWidth,height:window.innerHeight,resizeTo:window,backgroundColor:"#000000"}),L={x:K.view.width/2,y:K.view.height/2};var H=e(488),X={};X.styleTagTransform=f(),X.setAttributes=u(),X.insert=c().bind(null,"head"),X.domAPI=h(),X.insertStyleElement=p(),s()(H.Z,X),H.Z&&H.Z.locals&&H.Z.locals;var $=e(460),_={};_.styleTagTransform=f(),_.setAttributes=u(),_.insert=c().bind(null,"head"),_.domAPI=h(),_.insertStyleElement=p(),s()($.Z,_),$.Z&&$.Z.locals&&$.Z.locals;const G={dialog:function({content:t,options:i}){return n.createElement("div",{className:"dialog "+("fade"===(null==i?void 0:i.animation)?"dialog-animation-fade":"")},t.key&&n.createElement("kbd",{className:"dialog-key"},t.key),n.createElement("div",{className:"dialog-content "+("text"===(null==i?void 0:i.animation)?"dialog-animation-text":"")},t.message))}};function Q({onDeath:t}){const[i,e]=n.useState(!1),[a,o]=n.useState([]),[s,r]=n.useState(100);return n.useEffect((()=>{b.listen(((t,i)=>{switch(t){case"dialog-new":o((t=>[...t,i]));break;case"dialog-delete":o((t=>t.filter((t=>t.id!==i.id))));break;case"takeDamage":r((t=>t-10));break;case"show-bars-ui":e(!0);break;case"hide-bars-ui":e(!1)}}))}),[b]),n.useEffect((()=>{s<0&&t()}),[s]),n.createElement("div",{className:"ui-controller"},i&&n.createElement(n.Fragment,null,n.createElement("div",{className:"ui-hp-container"},n.createElement("div",null,"HP"),n.createElement("div",{style:{width:`${s}%`},className:"ui-hp-bar"})),n.createElement("div",{className:"ui-air-container"},n.createElement("div",null,"O2"),n.createElement("div",{style:{animationDuration:"120000ms"},className:"ui-air-bar"}))),a.map((t=>{const i=G[t.type];return n.createElement(i,Object.assign({key:t.id},t))})))}const V=new class{constructor(){this.map=new F,K.stage.filterArea=K.screen,this.crtFilter=new v.X({vignetting:1}),K.stage.filters=[this.crtFilter]}CRTAnimation(t,i){return U(this,void 0,void 0,(function*(){return new Promise((e=>{const n=setInterval((()=>{this.crtFilter.vignetting="forward"===t?this.crtFilter.vignetting-.01:this.crtFilter.vignetting+.01,("forward"===t?this.crtFilter.vignetting<.67:this.crtFilter.vignetting>=1)&&(clearInterval(n),e())}),i/60)}))}))}lose(t){return U(this,void 0,void 0,(function*(){if(!this.winCheckInterval)return;clearInterval(this.winCheckInterval),b.hideUI(),this.interactionManager.destroy(),this.map.destroy(),K.stage.removeChildren(),this.character=void 0;const i=b.showDialog({message:"air"===t?"I.. can't brea..":"It hurts so much.."});yield j(3e3),i(),b.showDialog({message:"You died doing what you love, losing. Press F5 to try again."})}))}win(){return U(this,void 0,void 0,(function*(){b.hideUI(),b.showDialog({message:"I survived ! Awesome ! Now I can walk here forever."},{dismissTimeout:1e4})}))}playStartAnimation(){return U(this,void 0,void 0,(function*(){let t=b.showDialog({message:"*CRASH*"},{animation:"text"});return yield j(2e3),t(),t=b.showDialog({message:"What was that ??"},{animation:"text"}),yield j(1e3),yield this.CRTAnimation("forward",2e3),t(),this.CRTAnimation("backwards",2e3)}))}init(){return U(this,void 0,void 0,(function*(){this.character=new T(this.map,K),yield this.character.init(),this.character.x=L.x-this.character.width,this.character.y=L.y,K.stage.addChild(this.character),yield this.playStartAnimation(),K.stage.removeChild(this.character),yield this.map.init(),this.character.x=this.map.startLocation.x*k,this.character.y=this.map.startLocation.y*k,this.map.addEntity(this.character),this.map.rooms.slice(1).forEach((t=>U(this,void 0,void 0,(function*(){const i=B(0,2);for(let e=0;e<i;e++){const i=new Y(this.map,K,2.5,350);yield i.init(),i.x=(t.actualCenter.x+e)*k,i.y=t.actualCenter.y*k,this.map.addEntity(i)}})))),this.map.container.x=L.x-this.character.x-this.character.width,this.map.container.y=L.y-this.character.y,K.stage.addChild(this.map.container),yield this.CRTAnimation("forward",2e3),this.interactionManager=new O(this.character,this.map,K),this.winCheckInterval=window.setInterval((()=>{this.map.cells.some((t=>t.damage>0))||(this.win(),clearInterval(this.winCheckInterval))}),1e3)}))}destroy(){this.interactionManager.destroy(),this.map.destroy()}};let q;(0,a.s)(document.getElementById("root")).render(n.createElement((function(){n.useEffect((()=>{const t=document.createElement("div");return t.className="game-canvas",t.appendChild(K.view),document.body.appendChild(t),V.init(),q=window.setTimeout((()=>{V.lose("air")}),C),V.destroy}),[]);const t=n.useCallback((()=>{clearTimeout(q),V.lose("hp")}),[]);return n.createElement(Q,{onDeath:t})}),null))}},e={};function n(t){var a=e[t];if(void 0!==a)return a.exports;var o=e[t]={id:t,loaded:!1,exports:{}};return i[t].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.m=i,t=[],n.O=(i,e,a,o)=>{if(!e){var s=1/0;for(c=0;c<t.length;c++){for(var[e,a,o]=t[c],r=!0,h=0;h<e.length;h++)(!1&o||s>=o)&&Object.keys(n.O).every((t=>n.O[t](e[h])))?e.splice(h--,1):(r=!1,o<s&&(s=o));if(r){t.splice(c--,1);var l=a();void 0!==l&&(i=l)}}return i}o=o||0;for(var c=t.length;c>0&&t[c-1][2]>o;c--)t[c]=t[c-1];t[c]=[e,a,o]},n.n=t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return n.d(i,{a:i}),i},n.d=(t,i)=>{for(var e in i)n.o(i,e)&&!n.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t={826:0};n.O.j=i=>0===t[i];var i=(i,e)=>{var a,o,[s,r,h]=e,l=0;if(s.some((i=>0!==t[i]))){for(a in r)n.o(r,a)&&(n.m[a]=r[a]);if(h)var c=h(n)}for(i&&i(e);l<s.length;l++)o=s[l],n.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return n.O(c)},e=self.webpackChunkweb_app=self.webpackChunkweb_app||[];e.forEach(i.bind(null,0)),e.push=i.bind(null,e.push.bind(e))})(),n.nc=void 0;var a=n.O(void 0,[814],(()=>n(113)));a=n.O(a)})();
//# sourceMappingURL=index.bundle.js.map